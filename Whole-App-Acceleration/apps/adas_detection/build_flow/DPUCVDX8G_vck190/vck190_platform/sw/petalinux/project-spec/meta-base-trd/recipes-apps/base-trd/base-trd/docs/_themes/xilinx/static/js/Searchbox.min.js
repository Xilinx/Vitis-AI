webpackJsonpCoveo__temporary([9,13,31,45],{133:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(6),o=n(4),r=n(2),u=n(8),a=n(9),l=n(1),c=n(3),p=n(13),h=n(14),g=function(t){function e(n,i,s){var a=t.call(this,n,e.ID,s)||this;if(a.element=n,a.options=i,r.$$(n).setAttribute("aria-label",u.l("Search")),a.bind.on(n,"click",function(){return a.handleClick()}),""==o.Utils.trim(r.$$(a.element).text())){var l=r.$$("span",{className:"coveo-search-button"},p.SVGIcons.icons.search).el;h.SVGDom.addClassToSVGInContainer(l,"coveo-search-button-svg");var c=r.$$("span",{className:"coveo-search-button-loading"},p.SVGIcons.icons.loading).el;h.SVGDom.addClassToSVGInContainer(c,"coveo-search-button-loading-svg"),n.appendChild(l),n.appendChild(c)}return a}return i(e,t),e.prototype.click=function(){this.handleClick()},e.prototype.handleClick=function(){this.logger.debug("Performing query following button click"),this.usageAnalytics.logSearchEvent(a.analyticsActionCauseList.searchboxSubmit,{}),this.queryController.executeQuery()},e.ID="SearchButton",e.doExport=function(){c.exportGlobally({SearchButton:e})},e.options={},e}(s.Component);e.SearchButton=g,l.Initialization.registerAutoCreateComponent(g)},14:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=function(){function t(){}return t.addClassToSVGInContainer=function(e,n){var i=e.querySelector("svg");i.setAttribute("class",""+t.getClass(i)+n)},t.removeClassFromSVGInContainer=function(e,n){var i=e.querySelector("svg");i.setAttribute("class",t.getClass(i).replace(n,""))},t.addStyleToSVGInContainer=function(t,e){var n=t.querySelector("svg");i.each(e,function(t,e){n.style[e]=t})},t.getClass=function(t){var e=t.getAttribute("class");return e?e+" ":""},t}();e.SVGDom=s},207:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(6),o=n(81),r=n(7),u=n(133),a=n(94),l=n(2),c=n(1),p=n(0),h=n(3);n(444);var g=n(13),d=n(14),f=function(t){function e(n,i,s){var c=t.call(this,n,e.ID,s)||this;if(c.element=n,c.options=i,c.options=r.ComponentOptions.initComponentOptions(n,e,i),c.options.inline&&l.$$(n).addClass("coveo-inline"),c.options.addSearchButton){var p=document.createElement("a");c.element.appendChild(p),c.searchButton=new u.SearchButton(p,void 0,s)}var h=document.createElement("div");c.element.appendChild(h),c.options.enableOmnibox?c.searchbox=new o.Omnibox(h,c.options,s):c.searchbox=new a.Querybox(h,c.options,s);var f=l.$$(c.element).find(".magic-box-icon");return f.innerHTML=g.SVGIcons.icons.mainClear,d.SVGDom.addClassToSVGInContainer(f,"magic-box-clear-svg"),c}return i(e,t),e.ID="Searchbox",e.parent=o.Omnibox,e.doExport=function(){h.exportGlobally({Searchbox:e,SearchButton:u.SearchButton,Omnibox:o.Omnibox,Querybox:a.Querybox})},e.options={addSearchButton:r.ComponentOptions.buildBooleanOption({defaultValue:!0}),enableOmnibox:r.ComponentOptions.buildBooleanOption({defaultValue:!0})},e}(s.Component);e.Searchbox=f,f.options=p.extend({},f.options,o.Omnibox.options,a.Querybox.options),p.each(f.options,function(t,e){e in o.Omnibox.options&&!(e in a.Querybox.options)&&(f.options[e]=p.extend({depend:"enableOmnibox"},t))}),c.Initialization.registerAutoCreateComponent(f)},323:function(t,e){var n,i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};!function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e,n){var i=this;this.expression=e,this.input=n,_.isString(t)?this.value=t:_.isArray(t)&&(this.subResults=t,_.forEach(this.subResults,function(t){t.parent=i}))}return t.prototype.isSuccess=function(){return null!=this.value||null!=this.subResults&&_.all(this.subResults,function(t){return t.isSuccess()})},t.prototype.path=function(t){var e=null!=this.parent&&this.parent!=t?this.parent.path(t):[];return e.push(this),e},t.prototype.findParent=function(t){for(var e=this,n=_.isString(t)?function(e){return t==e.expression.id}:t;null!=e&&!n(e);)e=e.parent;return e},t.prototype.find=function(t){var e=_.isString(t)?function(e){return t==e.expression.id}:t;if(e(this))return this;if(this.subResults)for(var n=0;n<this.subResults.length;n++){var i=this.subResults[n].find(e);if(i)return i}return null},t.prototype.findAll=function(t){var e=[],n=_.isString(t)?function(e){return t==e.expression.id}:t;return n(this)&&e.push(this),this.subResults&&(e=_.reduce(this.subResults,function(t,e){return t.concat(e.findAll(n))},e)),e},t.prototype.resultAt=function(t,e){if(t<0||t>this.getLength())return[];if(null!=e){if(_.isString(e)){if(e==this.expression.id)return[this]}else if(e(this))return[this]}else if(null!=(null==this.value&&null==this.subResults?this.input:this.value))return[this];if(null!=this.subResults){for(var n=[],i=0;i<this.subResults.length;i++){var s=this.subResults[i];if(n=n.concat(s.resultAt(t,e)),(t-=s.getLength())<0)break}return n}return[]},t.prototype.getExpect=function(){return null==this.value&&null==this.subResults?[this]:null!=this.subResults?_.reduce(this.subResults,function(t,e){return t.concat(e.getExpect())},[]):[]},t.prototype.getBestExpect=function(){var t=this.getExpect(),e=(n=_.groupBy(t,function(t){return t.input}))[_.last(_.keys(n).sort(function(t,e){return e.length-t.length}))],n=_.groupBy(e,function(t){return t.expression.id});return _.map(n,function(t){return _.chain(t).map(function(t){return{path:t.path().length,result:t}}).sortBy("path").pluck("result").first().value()})},t.prototype.getHumanReadableExpect=function(){var t=this.getBestExpect(),e=0<t.length?_.last(t).input:"";return"Expected "+_.map(t,function(t){return t.getHumanReadable()}).join(" or ")+" but "+(0<e.length?JSON.stringify(e[0]):"end of input")+" found."},t.prototype.before=function(){if(null==this.parent)return"";var t=_.indexOf(this.parent.subResults,this);return this.parent.before()+_.chain(this.parent.subResults).first(t).map(function(t){return t.toString()}).join("").value()},t.prototype.after=function(){if(null==this.parent)return"";var t=_.indexOf(this.parent.subResults,this);return _.chain(this.parent.subResults).last(this.parent.subResults.length-t-1).map(function(t){return t.toString()}).join("").value()+this.parent.after()},t.prototype.getLength=function(){return null!=this.value?this.value.length:null!=this.subResults?_.reduce(this.subResults,function(t,e){return t+e.getLength()},0):this.input.length},t.prototype.toHtmlElement=function(){var t=document.createElement("span"),e=null!=this.expression?this.expression.id:null;return null!=e&&t.setAttribute("data-id",e),t.setAttribute("data-success",this.isSuccess().toString()),null!=this.value?(t.appendChild(document.createTextNode(this.value)),t.setAttribute("data-value",this.value)):null!=this.subResults?_.each(this.subResults,function(e){t.appendChild(e.toHtmlElement())}):(t.appendChild(document.createTextNode(this.input)),t.setAttribute("data-input",this.input),t.className="magic-box-error"+(0<this.input.length?"":" magic-box-error-empty")),t.result=this,t},t.prototype.clean=function(e){if(null!=e||!this.isSuccess()){e=e||_.last(this.getBestExpect()).path(this);var n=_.first(e);if(null!=n){var i=_.indexOf(this.subResults,n),s=-1==i?[]:_.map(_.first(this.subResults,i),function(t){return t.clean()});return s.push(n.clean(_.rest(e))),new t(s,this.expression,this.input)}return new t(null,this.expression,this.input)}return null!=this.value?new t(this.value,this.expression,this.input):null!=this.subResults?new t(_.map(this.subResults,function(t){return t.clean()}),this.expression,this.input):void 0},t.prototype.clone=function(){return null!=this.value?new t(this.value,this.expression,this.input):null!=this.subResults?new t(_.map(this.subResults,function(t){return t.clone()}),this.expression,this.input):new t(null,this.expression,this.input)},t.prototype.toString=function(){return null!=this.value?this.value:null!=this.subResults?_.map(this.subResults,function(t){return t.toString()}).join(""):this.input},t.prototype.getHumanReadable=function(){return this.expression instanceof e.ExpressionConstant?JSON.stringify(this.expression.value):this.expression.id},t}(),e.Result=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(t){function n(n){t.call(this,[n],e.ExpressionEndOfInput,n.input);var i=new e.Result(null,e.ExpressionEndOfInput,n.input.substr(n.getLength()));(i.parent=this).subResults.push(i)}return i(n,t),n}(e.Result),e.EndOfInputResult=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(t){function n(e,n,i,s){var o=this;t.call(this,null!=e?[e]:null,n,i),this.result=e,this.expression=n,this.input=i,this.failAttempt=s,_.forEach(this.failAttempt,function(t){t.parent=o})}return i(n,t),n.prototype.getExpect=function(){var t=this,e=[];return null!=this.result&&(e=this.result.getExpect()),0<(e=_.reduce(this.failAttempt,function(t,e){return t.concat(e.getExpect())},e)).length&&_.all(e,function(e){return e.input==t.input})?[this]:e},n.prototype.clean=function(t){if(null!=t||!this.isSuccess()){t=_.rest(t||_.last(this.getBestExpect()).path(this));var n=_.first(t);return null==n?new e.Result(null,this.expression,this.input):new e.Result([n.clean(_.rest(t))],this.expression,this.input)}return new e.Result(_.map(this.result.subResults,function(t){return t.clean()}),this.expression,this.input)},n}(e.Result),e.OptionResult=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(t){function n(e,n,i,s){t.call(this,e,n,i),this.results=e,this.expression=n,this.input=i,_.last(e)!=s&&(this.failAttempt=s,null!=this.failAttempt&&(this.failAttempt.parent=this))}return i(n,t),n.prototype.getExpect=function(){var e=t.prototype.getExpect.call(this);return null!=this.failAttempt?e.concat(this.failAttempt.getExpect()):e},n.prototype.clean=function(n){if(null!=this.failAttempt&&(null!=n||!this.isSuccess())){n=n||_.last(this.getBestExpect()).path(this);var i=_.first(n);if(null!=i&&i==this.failAttempt){var s=_.last(this.subResults),o=_.map(null!=s&&s.isSuccess()?this.subResults:_.initial(this.subResults),function(t){return t.clean()});return o.push(i.clean(_.rest(n))),new e.Result(o,this.expression,this.input)}}return t.prototype.clean.call(this,n)},n}(e.Result),e.RefResult=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e){this.value=t,this.id=e}return t.prototype.parse=function(t,n){var i=0==t.indexOf(this.value),s=new e.Result(i?this.value:null,this,t);return i&&n&&t.length>this.value.length?new e.EndOfInputResult(s):s},t.prototype.toString=function(){return this.value},t}(),e.ExpressionConstant=n}(n||(n={})),function(t){(t.MagicBox||(t.MagicBox={})).ExpressionEndOfInput={id:"end of input",parse:null}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e,n){this.func=t,this.id=e,this.grammar=n}return t.prototype.parse=function(t,e){return this.func(t,e,this)},t.prototype.toString=function(){return this.id},t}(),e.ExpressionFunction=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e){if(this.parts=t,this.id=e,0==t.length)throw JSON.stringify(e)+" should have at least 1 parts"}return t.prototype.parse=function(t,n){for(var i,s=[],o=t,r=0;r<this.parts.length&&(i=this.parts[r].parse(o,n&&r==this.parts.length-1),s.push(i),i.isSuccess());r++)o=o.substr(i.getLength());return new e.Result(s,this,t)},t.prototype.toString=function(){return this.id},t}(),e.ExpressionList=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e){this.parts=t,this.id=e}return t.prototype.parse=function(t,n){for(var i=[],s=0;s<this.parts.length;s++){var o=this.parts[s].parse(t,n);if(o.isSuccess())return new e.OptionResult(o,this,t,i);i.push(o)}return new e.OptionResult(null,this,t,i)},t.prototype.toString=function(){return this.id},t}(),e.ExpressionOptions=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e,n,i){this.ref=t,this.occurrence=e,this.id=n,this.grammar=i}return t.prototype.parse=function(t,e){var n=this.grammar.getExpression(this.ref);if(null==n)throw"Expression not found:"+this.ref;return"?"==this.occurrence||null==this.occurrence?this.parseOnce(t,e,n):this.parseMany(t,e,n)},t.prototype.parseOnce=function(t,n,i){var s=i.parse(t,n),o=s.isSuccess();return o||"?"!=this.occurrence?new e.RefResult([s],this,t,o?null:s):n?0==t.length?new e.RefResult([],this,t,s):_.all(s.getBestExpect(),function(t){return t.expression==e.ExpressionEndOfInput})?new e.RefResult([new e.Result(null,e.ExpressionEndOfInput,t)],this,t,s):s:new e.RefResult([],this,t,null)},t.prototype.parseMany=function(t,n,i){for(var s,o,r=[],u=t;(o=(s=i.parse(u,!1)).isSuccess())&&(r.push(s),u=u.substr(s.getLength())),o&&s.input!=u;);var a=_.isNumber(this.occurrence)?this.occurrence:"+"==this.occurrence?1:0;if(r.length<a)r.push(s);else if(n)if(0<r.length){var l=_.last(r);(s=i.parse(l.input,!0)).isSuccess()?r[r.length-1]=s:(r.push(new e.Result(null,e.ExpressionEndOfInput,l.input.substr(l.getLength()))),s=i.parse(l.input.substr(l.getLength()),!0))}else if(0!=t.length){var c=new e.Result(null,e.ExpressionEndOfInput,t);return new e.RefResult([c],this,t,s)}return new e.RefResult(r,this,t,s)},t.prototype.toString=function(){return this.id},t}(),e.ExpressionRef=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,e,n){this.value=t,this.id=e}return t.prototype.parse=function(t,n){var i=t.match(this.value);null!=i&&0!=i.index&&(i=null);var s=new e.Result(null!=i?i[0]:null,this,t);return s.isSuccess()&&n&&t.length>s.value.length?new e.EndOfInputResult(s):s},t.prototype.toString=function(){return this.id},t}(),e.ExpressionRegExp=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,n){void 0===n&&(n={}),this.expressions={},this.start=new e.ExpressionRef(t,null,"start",this),this.addExpressions(n)}return t.prototype.addExpressions=function(t){var e=this;_.each(t,function(t,n){e.addExpression(n,t)})},t.prototype.addExpression=function(e,n){if(e in this.expressions)throw"Grammar already contain the id:"+e;this.expressions[e]=t.buildExpression(n,e,this)},t.prototype.getExpression=function(t){return this.expressions[t]},t.prototype.parse=function(t){return this.start.parse(t,!0)},t.buildExpression=function(t,n,i){if(void 0===t)throw"Invalid Expression: "+t;if(_.isString(t))return this.buildStringExpression(t,n,i);if(_.isArray(t))return new e.ExpressionOptions(_.map(t,function(t,s){return new e.ExpressionRef(t,null,n+"_"+s,i)}),n);if(_.isRegExp(t))return new e.ExpressionRegExp(t,n,i);if(_.isFunction(t))return new e.ExpressionFunction(t,n,i);throw"Invalid Expression: "+t},t.buildStringExpression=function(n,i,s){var o=t.stringMatch(n,t.spliter),r=_.map(o,function(t,n){if(t[1]){var o=t[1],r=t[3]?Number(t[3]):t[2]||null;return new e.ExpressionRef(o,r,i+"_"+n,s)}return new e.ExpressionConstant(t[4],i+"_"+n)});if(1==r.length){var u=r[0];return u.id=i,u}return new e.ExpressionList(r,i)},t.stringMatch=function(t,e){for(var n,i=[],s=new RegExp(e.source,"g");null!==(n=s.exec(t));)i.push(n);return i},t.spliter=/\[(\w+)(\*|\+|\?|\{([1-9][0-9]*)\})?\]|(.[^\[]*)/,t}(),e.Grammar=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,n,i){this.element=t,this.onchange=n,this.magicBox=i,this.hasFocus=!1,this.underlay=document.createElement("div"),this.underlay.className="magic-box-underlay",this.highlightContainer=document.createElement("span"),this.highlightContainer.className="magic-box-highlight-container",this.underlay.appendChild(this.highlightContainer),this.ghostTextContainer=document.createElement("span"),this.ghostTextContainer.className="magic-box-ghost-text",this.underlay.appendChild(this.ghostTextContainer),this.input=e.$$(t).find("input"),this.input?t.insertBefore(this.underlay,this.input):(this.input=document.createElement("input"),t.appendChild(this.underlay),t.appendChild(this.input)),this.input.spellcheck=!1,this.input.setAttribute("form","coveo-dummy-form"),this.input.setAttribute("autocomplete","off"),this.setupHandler()}return t.prototype.updateInput=function(){this.input.value!=this.result.input&&(this.input.value=this.result.input,this.hasFocus&&this.setCursor(this.getValue().length))},t.prototype.updateHighlight=function(){e.$$(this.highlightContainer).empty(),this.highlightContainer.appendChild(this.result.toHtmlElement())},t.prototype.updateWordCompletion=function(){e.$$(this.ghostTextContainer).empty(),null!=this.wordCompletion&&this.ghostTextContainer.appendChild(document.createTextNode(this.wordCompletion.substr(this.result.input.length)))},t.prototype.updateScroll=function(t){var n=this;void 0===t&&(t=!0);var i=function(){n.underlay.clientWidth<n.underlay.scrollWidth&&(n.underlay.style.visibility="hidden",n.underlay.scrollLeft=n.input.scrollLeft,n.underlay.scrollTop=n.input.scrollTop,n.underlay.style.visibility="visible"),n.updateScrollDefer=null,n.hasFocus&&n.updateScroll()};t?null==this.updateScrollDefer&&(this.updateScrollDefer=e.requestAnimationFrame(i)):i()},t.prototype.setResult=function(t,e){this.result=t,this.updateInput(),this.updateHighlight(),_.isUndefined(e)&&null!=this.wordCompletion&&0==this.wordCompletion.indexOf(this.result.input)?this.updateWordCompletion():this.setWordCompletion(e),this.updateScroll()},t.prototype.setWordCompletion=function(t){null!=t&&0!=t.toLowerCase().indexOf(this.result.input.toLowerCase())&&(t=null),this.wordCompletion=t,this.updateWordCompletion(),this.updateScroll()},t.prototype.setCursor=function(t){if(this.input.focus(),this.input.createTextRange){var e=this.input.createTextRange();e.move("character",t),e.select()}else null!=this.input.selectionStart&&(this.input.focus(),this.input.setSelectionRange(t,t))},t.prototype.getCursor=function(){return this.input.selectionStart},t.prototype.setupHandler=function(){var t=this;this.input.onblur=function(){t.hasFocus=!1,setTimeout(function(){t.hasFocus||t.onblur&&t.onblur()},300),t.updateScroll()},this.input.onfocus=function(){t.hasFocus||(t.hasFocus=!0,t.updateScroll(),t.onfocus&&t.onfocus())},this.input.onkeydown=function(e){t.keydown(e)},this.input.onkeyup=function(e){t.keyup(e)},this.input.onclick=function(){t.onchangecursor()},this.input.oncut=function(){setTimeout(function(){t.onInputChange()})},this.input.onpaste=function(){setTimeout(function(){t.onInputChange()})}},t.prototype.focus=function(){var t=this;this.hasFocus=!0,setTimeout(function(){t.input.focus(),t.setCursor(t.getValue().length)})},t.prototype.blur=function(){this.hasFocus&&this.input.blur()},t.prototype.keydown=function(t){var n=this;switch(t.keyCode||t.which){case 9:this.tabPress(),this.magicBox.clearSuggestion();break;default:t.stopPropagation(),null==this.onkeydown||this.onkeydown(t.keyCode||t.which)?e.requestAnimationFrame(function(){n.onInputChange()}):t.preventDefault()}},t.prototype.keyup=function(t){switch(t.keyCode||t.which){case 37:case 39:this.onchangecursor();break;default:null==this.onkeydown||this.onkeyup(t.keyCode||t.which)?this.onInputChange():t.preventDefault()}},t.prototype.tabPress=function(){this.ontabpress&&this.ontabpress(),this.onblur&&this.onblur()},t.prototype.onInputChange=function(){this.result.input!=this.input.value&&this.onchange(this.input.value,!1)},t.prototype.getValue=function(){return this.input.value},t.prototype.getWordCompletion=function(){return this.wordCompletion},t}(),e.InputManager=n}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,n){var i=this;this.element=t,this.count=1,this.options=_.defaults(n,{selectableClass:"magic-box-suggestion",selectedClass:"magic-box-selected"}),null==this.options.timeout&&(this.options.timeout=500),this.hasSuggestions=!1,e.$$(this.element).on("mouseover",function(t){i.handleMouseOver(t)}),e.$$(this.element).on("mouseout",function(t){i.handleMouseOut(t)})}return t.prototype.handleMouseOver=function(t){var n=e.$$(t.target),i=n.parents(this.options.selectableClass);n.hasClass(this.options.selectableClass)?this.addSelectedClass(n.el):0<i.length&&this.element.contains(i[0])&&this.addSelectedClass(i[0])},t.prototype.handleMouseOut=function(t){var n=e.$$(t.target),i=n.parents(this.options.selectableClass);if(t.relatedTarget){var s=e.$$(t.relatedTarget).parents(this.options.selectableClass);n.hasClass(this.options.selectedClass)&&!e.$$(t.relatedTarget).hasClass(this.options.selectableClass)?n.removeClass(this.options.selectedClass):0==s.length&&0<i.length&&e.$$(i[0]).removeClass(this.options.selectedClass)}else n.hasClass(this.options.selectedClass)?n.removeClass(this.options.selectedClass):0<i.length&&e.$$(i[0]).removeClass(this.options.selectedClass)},t.prototype.moveDown=function(){var t=this.element.getElementsByClassName(this.options.selectedClass).item(0),n=this.element.getElementsByClassName(this.options.selectableClass),i=-1;if(null!=t){e.$$(t).removeClass(this.options.selectedClass);for(var s=0;s<n.length;s++)if(t==n.item(s)){i=s;break}i=-1==i?0:i+1}else i=0;return null!=(t=n.item(i))&&e.$$(t).addClass(this.options.selectedClass),this.returnMoved(t)},t.prototype.moveUp=function(){var t=this.element.getElementsByClassName(this.options.selectedClass).item(0),n=this.element.getElementsByClassName(this.options.selectableClass),i=-1;if(null!=t){e.$$(t).removeClass(this.options.selectedClass);for(var s=0;s<n.length;s++)if(t==n.item(s)){i=s;break}i=-1==i?n.length-1:i-1}else i=n.length-1;return null!=(t=n.item(i))&&e.$$(t).addClass(this.options.selectedClass),this.returnMoved(t)},t.prototype.select=function(){var t=this.element.getElementsByClassName(this.options.selectedClass).item(0);return null!=t&&e.$$(t).trigger("keyboardSelect"),t},t.prototype.mergeSuggestions=function(t,e){var n,i=this,s=[],o=!0;t=_.compact(t);var r=this.pendingSuggestion=new Promise(function(e,u){_.each(t,function(t){var e=!1;setTimeout(function(){o=!(e=!0)},i.options.timeout),t.then(function(t){!e&&t&&(s=s.concat(t))})});var a=function(){o&&(n&&clearTimeout(n),0==s.length?e([]):r==i.pendingSuggestion||null==i.pendingSuggestion?e(s.sort(function(t,e){return e.index-t.index})):u("new request queued")),o=!1};0==t.length&&a(),null==t&&a(),n=setTimeout(function(){a()},i.options.timeout),Promise.all(t).then(function(){return a()})});r.then(function(t){return e&&e(t),i.updateSuggestions(t),t}).catch(function(){return null})},t.prototype.updateSuggestions=function(t){var n=this;e.$$(this.element).empty(),this.element.className="magic-box-suggestions",_.each(t,function(t){var i=t.dom;if(i){e.$$(i).removeClass(n.options.selectedClass);var s=e.$$(i).find("."+n.options.selectableClass);e.$$(s).removeClass(n.options.selectedClass)}else{if((i=document.createElement("div")).className="magic-box-suggestion",null!=t.html)i.innerHTML=t.html;else if(null!=t.text)i.appendChild(document.createTextNode(t.text));else if(null!=t.separator){i.className="magic-box-suggestion-seperator";var o=document.createElement("div");o.className="magic-box-suggestion-seperator-label",o.appendChild(document.createTextNode(t.separator)),i.appendChild(o)}e.$$(i).on("click",function(){t.onSelect()}),e.$$(i).on("keyboardSelect",function(){t.onSelect()}),e.$$(i).addClass(n.options.selectableClass)}i.suggestion=t,n.element.appendChild(i)}),0<t.length?(e.$$(this.element).addClass("magic-box-hasSuggestion"),this.hasSuggestions=!0):(e.$$(this.element).removeClass("magic-box-hasSuggestion"),this.hasSuggestions=!1)},t.prototype.returnMoved=function(t){if(null!=t){if(t.suggestion)return t.suggestion;if(t["no-text-suggestion"])return null;if(t instanceof HTMLElement)return{text:e.$$(t).text()}}return null},t.prototype.addSelectedClass=function(t){for(var n=this.element.getElementsByClassName(this.options.selectedClass),i=0;i<n.length;i++){var s=n.item(i);e.$$(s).removeClass(this.options.selectedClass)}e.$$(t).addClass(this.options.selectedClass)},t}(),e.SuggestionsManager=n}(n||(n={})),function(t){var e;!function(t){t.highlightText=function(t,e,n,i,s){if(void 0===n&&(n=!1),void 0===i&&(i="magic-box-hightlight"),void 0===s&&(s=""),0==e.length)return t;var o=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r=new RegExp("("+o+")|(.*?(?="+o+")|.+)",n?"gi":"g");return t.replace(r,function(t,e,n){return o=t,'<span class="'+(null!=e?i:s)+'">'+_.escape(o)+"</span>";var o})};var n=function(){function t(t){this.el=t}return t.prototype.text=function(t){if(!t)return this.el.innerText||this.el.textContent;null!=this.el.innerText?this.el.innerText=t:null!=this.el.textContent&&(this.el.textContent=t)},t.prototype.nodeListToArray=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t.item(e);return n},t.prototype.empty=function(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild)},t.prototype.show=function(){this.el.style.display="visible"},t.prototype.hide=function(){this.el.style.display="none"},t.prototype.toggle=function(t){void 0===t?"visible"==this.el.style.display?this.hide():this.show():t?this.show():this.hide()},t.prototype.find=function(t){return this.el.querySelector(t)},t.prototype.is=function(t){return this.el.tagName.toLowerCase()==t.toLowerCase()||!("."!=t[0]||!this.hasClass(t.substr(1)))||"#"==t[0]&&this.el.getAttribute("id")==t.substr(1)},t.prototype.closest=function(t){for(var n=this.el,i=!1;!i&&(e.$$(n).hasClass(t)&&(i=!0),"body"!=n.tagName.toLowerCase())&&null!=n.parentElement;)i||(n=n.parentElement);if(i)return n},t.prototype.parent=function(t){if(null!=this.el.parentElement)return this.traverseAncestorForClass(this.el.parentElement,t)},t.prototype.parents=function(e){for(var n=[],i=this.parent(e);i;)n.push(i),i=new t(i).parent(e);return n},t.prototype.findAll=function(t){return this.nodeListToArray(this.el.querySelectorAll(t))},t.prototype.findClass=function(t){return"getElementsByClassName"in this.el?this.nodeListToArray(this.el.getElementsByClassName(t)):this.nodeListToArray(this.el.querySelectorAll("."+t))},t.prototype.findId=function(t){return document.getElementById(t)},t.prototype.addClass=function(t){this.hasClass(t)||(this.el.className?this.el.className+=" "+t:this.el.className=t)},t.prototype.removeClass=function(t){this.el.className=this.el.className.replace(new RegExp("(^|\\s)"+t+"(\\s|\\b)","g"),"$1")},t.prototype.toggleClass=function(t,e){e?this.addClass(t):this.removeClass(t)},t.prototype.getClass=function(){return this.el.className.match(t.CLASS_NAME_REGEX)||[]},t.prototype.hasClass=function(t){return _.contains(this.getClass(),t)},t.prototype.detach=function(){this.el.parentElement&&this.el.parentElement.removeChild(this.el)},t.prototype.on=function(e,n){var i=this;if(_.isArray(e))_.each(e,function(t){i.on(t,n)});else{var s=this.getJQuery();if(s)s(this.el).on(e,n);else if(this.el.addEventListener){var o=function(t){n(t,t.detail)};t.handlers.push({eventHandle:n,fn:o}),this.el.addEventListener(e,o,!1)}else this.el.on&&this.el.on("on"+e,n)}},t.prototype.one=function(t,e){var n=this;if(_.isArray(t))_.each(t,function(t){n.one(t,e)});else{var i=function(s){return n.off(t,i),e(s)};this.on(t,i)}},t.prototype.off=function(e,n){var i=this;if(_.isArray(e))_.each(e,function(t){i.off(t,n)});else{var s=this.getJQuery();if(s)s(this.el).off(e,n);else if(this.el.removeEventListener){var o=0,r=_.find(t.handlers,function(t,e){if(t.eventHandle==n)return o=e,!0});r&&(this.el.removeEventListener(e,r.fn,!1),t.handlers.splice(o,1))}else this.el.off&&this.el.off("on"+e,n)}},t.prototype.trigger=function(t,e){var n=this.getJQuery();if(n)n(this.el).trigger(t,e);else if(void 0!==CustomEvent){var i=new CustomEvent(t,{detail:e,bubbles:!0});this.el.dispatchEvent(i)}},t.prototype.isEmpty=function(){return t.ONLY_WHITE_SPACE_REGEX.test(this.el.innerHTML)},t.prototype.isDescendant=function(t){for(var e=this.el.parentNode;null!=e;){if(e==t)return!0;e=e.parentNode}return!1},t.prototype.traverseAncestorForClass=function(t,n){void 0===t&&(t=this.el),0==n.indexOf(".")&&(n=n.substr(1));for(var i=!1;!i&&(e.$$(t).hasClass(n)&&(i=!0),"body"!=t.tagName.toLowerCase())&&null!=t.parentElement;)i||(t=t.parentElement);if(i)return t},t.prototype.getJQuery=function(){return null!=window.jQuery&&window.jQuery},t.CLASS_NAME_REGEX=/-?[_a-zA-Z]+[_a-zA-Z0-9-]*/g,t.ONLY_WHITE_SPACE_REGEX=/^\s*$/,t.handlers=[],t}();t.Dom=n}((e=t.MagicBox||(t.MagicBox={})).Utils||(e.Utils={}))}(n||(n={})),function(t){var e;(e=t.MagicBox||(t.MagicBox={})).$$=function(t){return window.Coveo&&window.Coveo.$$?window.Coveo.$$(t):new e.Utils.Dom(t)}}(n||(n={})),function(t){var e;!function(t){function n(t,e,n,i){_.each(i.expressions,function(e){_.contains(t,e)||t.push(e)}),_.each(i.basicExpressions,function(t){_.contains(e,t)||e.push(t)}),_.each(i.grammars,function(t,e){if(e in n){if(!_.isArray(n[e])||!_.isArray(t))throw _.each(t,function(t){n[e].push(t)}),"Can not merge "+e+"("+new String(t)+" => "+new String(n[e])+")";_.each(t,function(t){n[e].push(t)})}else n[e]=t})}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i=[],s=[],o={Start:["Expressions","Empty"],Expressions:"[OptionalSpaces][Expression][ExpressionsList*][OptionalSpaces]",ExpressionsList:"[Spaces][Expression]",Expression:i,BasicExpression:s,OptionalSpaces:/ */,Spaces:/ +/,Empty:/(?!.)/},r=0;r<t.length;r++)n(i,s,o,t[r]),_.each(t[r].include,function(e){_.contains(t,e)||t.push(e)});return i.push("BasicExpression"),{start:"Start",expressions:o}}t.Expressions=i,t.ExpressionsGrammar=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];var s=i.apply(this,t);return new e.Grammar(s.start,s.expressions)}}((e=t.MagicBox||(t.MagicBox={})).Grammars||(e.Grammars={}))}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),(n=e.Grammars||(e.Grammars={})).notWordStart=" ()[],$@'\"",n.notInWord=" ()[],:",n.Basic={basicExpressions:["Word","DoubleQuoted"],grammars:{DoubleQuoted:'"[NotDoubleQuote]"',NotDoubleQuote:/[^"]*/,SingleQuoted:"'[NotSingleQuote]'",NotSingleQuote:/[^']*/,Number:/-?(0|[1-9]\d*)(\.\d+)?/,Word:function(t,i,s){var o=new RegExp("[^"+n.notWordStart.replace(/(.)/g,"\\$1")+"][^"+n.notInWord.replace(/(.)/g,"\\$1")+"]*"),r=t.match(o);null!=r&&0!=r.index&&(r=null);var u=new e.Result(null!=r?r[0]:null,s,t);return u.isSuccess()&&i&&t.length>u.value.length?new e.EndOfInputResult(u):u}}}}(n||(n={})),function(t){var e;((e=t.MagicBox||(t.MagicBox={})).Grammars||(e.Grammars={})).SubExpression={basicExpressions:["SubExpression"],grammars:{SubExpression:"([Expressions])"}}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),(n=e.Grammars||(e.Grammars={})).Date={grammars:{Date:"[DateYear]/[DateMonth]/[DateDay]",DateYear:/([0-9]{4})/,DateMonth:/(1[0-2]|0?[1-9])/,DateDay:/([1-2][0-9]|3[0-1]|0?[1-9])/,DateRange:"[Date][Spaces?]..[Spaces?][Date]",DateRelative:["DateRelativeNegative","DateRelativeTerm"],DateRelativeTerm:/now|today|yesterday/,DateRelativeNegative:"[DateRelativeTerm][DateRelativeNegativeRef]",DateRelativeNegativeRef:/([\-\+][0-9]+(s|m|h|d|mo|y))/},include:[n.Basic]}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),(n=e.Grammars||(e.Grammars={})).Field={basicExpressions:["FieldSimpleQuery","FieldQuery","Field"],grammars:{FieldQuery:"[Field][OptionalSpaces][FieldQueryOperation]",FieldQueryOperation:["FieldQueryValue","FieldQueryNumeric"],FieldQueryValue:"[FieldOperator][OptionalSpaces][FieldValue]",FieldQueryNumeric:"[FieldOperatorNumeric][OptionalSpaces][FieldValueNumeric]",FieldSimpleQuery:"[FieldName]:[OptionalSpaces][FieldValue]",Field:"@[FieldName]",FieldName:/[a-zA-Z][a-zA-Z0-9\.\_]*/,FieldOperator:/==|=|<>/,FieldOperatorNumeric:/<=|>=|<|>/,FieldValue:["DateRange","NumberRange","DateRelative","Date","Number","FieldValueList","FieldValueString"],FieldValueNumeric:["DateRelative","Date","Number"],FieldValueString:["DoubleQuoted","FieldValueNotQuoted"],FieldValueList:"([FieldValueString][FieldValueStringList*])",FieldValueStringList:"[FieldValueSeparator][FieldValueString]",FieldValueSeparator:/ *, */,FieldValueNotQuoted:/[^ \(\),]+/,NumberRange:"[Number][Spaces?]..[Spaces?][Number]"},include:[n.Date,n.Basic]}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),(n=e.Grammars||(e.Grammars={})).QueryExtension={basicExpressions:["QueryExtension"],grammars:{QueryExtension:"$[QueryExtensionName]([QueryExtensionArguments])",QueryExtensionName:/\w+/,QueryExtensionArguments:"[QueryExtensionArgumentList*][QueryExtensionArgument]",QueryExtensionArgumentList:"[QueryExtensionArgument][Spaces?],[Spaces?]",QueryExtensionArgument:"[QueryExtensionArgumentName]:[Spaces?][QueryExtensionArgumentValue]",QueryExtensionArgumentName:/\w+/,QueryExtensionArgumentValue:["SingleQuoted","Expressions"]},include:[n.Basic]}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),(n=e.Grammars||(e.Grammars={})).NestedQuery={basicExpressions:["NestedQuery"],grammars:{NestedQuery:"[[NestedField][OptionalSpaces][Expressions]]",NestedField:"[[Field]]",FieldValue:["NestedQuery"]},include:[n.Field]}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),(n=e.Grammars||(e.Grammars={})).Complete={include:[n.NestedQuery,n.QueryExtension,n.SubExpression,n.Field,n.Basic]}}(n||(n={})),function(t){var e,n;e=t.MagicBox||(t.MagicBox={}),n=function(){function t(t,n,i){var s=this;void 0===i&&(i={}),this.element=t,this.grammar=n,this.options=i,this.lastSuggestions=[],_.isUndefined(this.options.inline)&&(this.options.inline=!1),e.$$(t).addClass("magic-box"),this.options.inline&&e.$$(t).addClass("magic-box-inline"),this.result=this.grammar.parse(""),this.displayedResult=this.result.clean(),this.clearDom=document.createElement("div"),this.clearDom.className="magic-box-clear";var o=document.createElement("div");o.className="magic-box-icon",this.clearDom.appendChild(o);var r=e.$$(t).find(".magic-box-input");r?t.insertBefore(this.clearDom,r):((r=document.createElement("div")).className="magic-box-input",t.appendChild(this.clearDom),t.appendChild(r)),this.inputManager=new e.InputManager(r,function(t,e){e?(s.setText(t),s.onselect&&s.onselect(s.getFirstSuggestionText())):(s.setText(t),s.showSuggestion(),s.onchange&&s.onchange())},this),this.inputManager.ontabpress=function(){s.ontabpress&&s.ontabpress()};var u=this.inputManager.getValue();u&&(this.displayedResult.input=u),this.inputManager.setResult(this.displayedResult);var a=document.createElement("div");a.className="magic-box-suggestions",this.element.appendChild(a),this.suggestionsManager=new e.SuggestionsManager(a,{selectableClass:this.options.selectableSuggestionClass,selectedClass:this.options.selectedSuggestionClass,timeout:this.options.suggestionTimeout}),this.setupHandler()}return t.prototype.getResult=function(){return this.result},t.prototype.getDisplayedResult=function(){return this.displayedResult},t.prototype.setText=function(t){e.$$(this.element).toggleClass("magic-box-notEmpty",0<t.length),this.result=this.grammar.parse(t),this.displayedResult=this.result.clean(),this.inputManager.setResult(this.displayedResult)},t.prototype.setCursor=function(t){this.inputManager.setCursor(t)},t.prototype.getCursor=function(){return this.inputManager.getCursor()},t.prototype.resultAtCursor=function(t){return this.displayedResult.resultAt(this.getCursor(),t)},t.prototype.setupHandler=function(){var t=this;this.inputManager.onblur=function(){e.$$(t.element).removeClass("magic-box-hasFocus"),t.onblur&&t.onblur(),t.options.inline||t.clearSuggestion()},this.inputManager.onfocus=function(){e.$$(t.element).addClass("magic-box-hasFocus"),t.showSuggestion(),t.onfocus&&t.onfocus()},this.inputManager.onkeydown=function(e){return 38!=e&&40!=e&&(13==e?(null==t.suggestionsManager.select()&&t.onsubmit&&t.onsubmit(),!1):(27==e&&(t.clearSuggestion(),t.blur()),!0))},this.inputManager.onchangecursor=function(){t.showSuggestion()},this.inputManager.onkeyup=function(e){if(38==e)t.onmove&&t.onmove(),t.focusOnSuggestion(t.suggestionsManager.moveUp()),t.onchange&&t.onchange();else{if(40!=e)return!0;t.onmove&&t.onmove(),t.focusOnSuggestion(t.suggestionsManager.moveDown()),t.onchange&&t.onchange()}return!1},this.clearDom.onclick=function(){t.clear()}},t.prototype.showSuggestion=function(){var t=this;this.suggestionsManager.mergeSuggestions(null!=this.getSuggestions?this.getSuggestions():[],function(e){t.updateSuggestion(e)})},t.prototype.updateSuggestion=function(t){var e=this;this.lastSuggestions=t;var n=this.getFirstSuggestionText();this.inputManager.setWordCompletion(n&&n.text),this.onsuggestions&&this.onsuggestions(t),_.each(t,function(t){null==t.onSelect&&null!=t.text&&(t.onSelect=function(){e.setText(t.text),e.onselect&&e.onselect(t)})})},t.prototype.focus=function(){e.$$(this.element).addClass("magic-box-hasFocus"),this.inputManager.focus()},t.prototype.blur=function(){this.inputManager.blur()},t.prototype.clearSuggestion=function(){var t=this;this.suggestionsManager.mergeSuggestions([],function(e){t.updateSuggestion(e)}),this.inputManager.setWordCompletion(null)},t.prototype.focusOnSuggestion=function(t){null==t||null==t.text?(t=this.getFirstSuggestionText(),this.inputManager.setResult(this.displayedResult,t&&t.text)):this.inputManager.setResult(this.grammar.parse(t.text).clean(),t.text)},t.prototype.getFirstSuggestionText=function(){return _.find(this.lastSuggestions,function(t){return null!=t.text})},t.prototype.getText=function(){return this.inputManager.getValue()},t.prototype.getWordCompletion=function(){return this.inputManager.getWordCompletion()},t.prototype.clear=function(){this.setText(""),this.showSuggestion(),this.focus(),this.onclear&&this.onclear()},t.prototype.hasSuggestions=function(){return this.suggestionsManager.hasSuggestions},t}(),e.Instance=n,e.create=function(t,e,i){return new n(t,e,i)},e.requestAnimationFrame=function(t){return"requestAnimationFrame"in window?window.requestAnimationFrame(t):setTimeout(t)}}(n||(n={})),t.exports=n.MagicBox},324:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(53),o=function(){function t(t){this.options=t}return t.queryIsBlocked=function(){return!!t.queryIsCurrentlyBlocked||(t.queryIsCurrentlyBlocked=!0,s.Defer.defer(function(){return t.allowDuplicateQuery()}),!1)},t.allowDuplicateQuery=function(){t.queryIsCurrentlyBlocked=!1},t.prototype.addParameters=function(e,n){t.queryIsBlocked()||(this.options.enableWildcards&&(e.enableWildcards=!0),this.options.enableQuestionMarks&&(e.enableQuestionMarks=!0),this.options.enableLowercaseOperators&&(e.enableLowercaseOperators=!0),i.isEmpty(n)||(e.enableQuerySyntax=this.options.enableQuerySyntax,e.expression.add(n),this.options.enablePartialMatch&&(e.enablePartialMatch=this.options.enablePartialMatch,this.options.partialMatchKeywords&&(e.partialMatchKeywords=this.options.partialMatchKeywords),this.options.partialMatchThreshold&&(e.partialMatchThreshold=this.options.partialMatchThreshold))))},t.queryIsCurrentlyBlocked=!1,t}();e.QueryboxQueryParameters=o},325:function(t,e,n){"use strict";var i=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t};Object.defineProperty(e,"__esModule",{value:!0});var s=n(24),o=function(){function t(t){this.owner=t}return Object.defineProperty(t.prototype,"options",{get:function(){return this.owner.options},set:function(t){this.owner.options=t},enumerable:!0,configurable:!0}),t.prototype.postProcess=function(){this.options=i({},this.options,this.owner.componentOptionsModel.get(s.ComponentOptionsModel.attributesEnum.searchBox)),this.processQueryOnClearVersusEmptyQuery(),this.processQueryOnClearVersusSearchAsYouType()},t.prototype.processQueryOnClearVersusEmptyQuery=function(){this.options.triggerQueryOnClear&&!1===this.owner.searchInterface.options.allowQueriesWithoutKeywords&&(this.owner.logger.warn('Forcing option triggerQueryOnClear to false, as it is not supported when the search interface is configured to not allow queries without keywords (data-allow-queries-without-keywords="false")',this.owner),this.options.triggerQueryOnClear=!1)},t.prototype.processQueryOnClearVersusSearchAsYouType=function(){!0===this.owner.searchInterface.options.allowQueriesWithoutKeywords&&!1===this.options.triggerQueryOnClear&&!0===this.options.enableSearchAsYouType&&(this.owner.logger.warn("Forcing option triggerQueryOnClear to true, since search as you type is enabled",this.owner),this.options.triggerQueryOnClear=!0)},t}();e.QueryboxOptionsProcessing=o},326:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.cache={}}return t.prototype.getSuggestions=function(t,e){var n=this;if(null!=this.cache[t])return this.cache[t];var i=e();return this.cache[t]=i,i.catch(function(){return n.clearSuggestion(t)}),this.cache[t]},t.prototype.clearSuggestion=function(t){if(!t||0===t.length)return null;delete this.cache[t]},t}();e.SuggestionsCache=i},351:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(81),s=n(30),o=n(0),r=function(){function t(t){var e=this;this.omnibox=t,this.cache={},this.omnibox.bind.on(this.omnibox.element,s.OmniboxEvents.populateOmniboxSuggestions,function(t){t.suggestions.push(e.getSuggestion())})}return t.prototype.getSuggestion=function(){var t=this,e=this.getHash();if(null==e)return null;var n=this.hashToString(e);if(null!=this.cache[n])return this.hashValueToSuggestion(e,this.cache[n]);var i;return"FieldName"==e.type&&(i=this.fieldNames(e.current)),"FieldValue"==e.type&&(i=this.fieldValues(e.field,e.current)),"SimpleFieldName"==e.type&&(i=this.simpleFieldNames(e.current)),this.cache[n]=i,i.catch(function(){delete t.cache[n]}),this.hashValueToSuggestion(e,i)},t.prototype.getHash=function(){var t=o.last(this.omnibox.resultAtCursor("FieldName"));if(null!=t){t=t.findParent("Field")||t;var e=t.toString(),n=t.before(),i=t.after();return{type:"FieldName",current:e,before:n,after:i}}var s=o.last(this.omnibox.resultAtCursor("FieldValue"));if(s){var r=s.findParent("FieldQuery")||this.omnibox.options.enableSimpleFieldAddon&&s.findParent("FieldSimpleQuery");if(r){var u=r.find("FieldName").toString();this.omnibox.options.fieldAlias&&u in this.omnibox.options.fieldAlias&&(u=this.omnibox.options.fieldAlias[u]);var a=s.toString(),n=s.before(),i=s.after();return{type:"FieldValue",field:u,current:a,before:n,after:i}}}if(this.omnibox.options.enableSimpleFieldAddon){var l=o.last(this.omnibox.resultAtCursor("Word"));if(null!=l){var c=l.toString(),n=l.before(),i=l.after();return{type:"SimpleFieldName",current:c,before:n,after:i}}}},t.prototype.hashToString=function(t){return null==t?null:t.type+t.current+(t.field||"")},t.prototype.hashValueToSuggestion=function(e,n){return n.then(function(n){return o.map(n,function(s,o){return{text:e.before+(0==e.current.toLowerCase().indexOf(s.toLowerCase())?e.current+s.substr(e.current.length):s)+e.after,html:i.MagicBox.Utils.highlightText(s,e.current,!0),index:t.INDEX-o/n.length}})})},t.prototype.getFields=function(){var t=this;return null==this.fields&&(this.fields=new Promise(function(e,n){if(null!=t.omnibox.options.listOfFields)e(t.omnibox.options.listOfFields);else{t.omnibox.queryController.getEndpoint().listFields().then(function(t){var n=o.chain(t).filter(function(t){return t.includeInQuery&&t.groupByField}).map(function(t){return t.name.substr(1)}).value();e(n)}).catch(function(){n()})}})),this.fields},t.prototype.fieldNames=function(t){var e=t.length>0&&"@"==t[0],n=e?t.substr(1):t,i=n.toLowerCase();return this.getFields().then(function(e){var n=o.chain(e).map(function(t){var e=t.length>0&&"@"==t[0];return{index:t.toLowerCase().indexOf(i),field:e?t:"@"+t}}).filter(function(e){return-1!=e.index&&e.field.length>t.length}).sortBy("index").map(function(t){return t.field}).value();return n=o.first(n,5)})},t.prototype.fieldValues=function(t,e){return this.omnibox.queryController.getEndpoint().listFieldValues({pattern:".*"+e+".*",patternType:"RegularExpression",sortCriteria:"occurrences",field:"@"+t,maximumNumberOfValues:5}).then(function(t){return o.chain(t).map(function(t){return{index:t.value.toLowerCase().indexOf(e),value:t.value}}).filter(function(t){return t.value.length>e.length}).sortBy("index").map(function(t){return t.value.replace(/ /g,"Â ")}).value()})},t.prototype.simpleFieldNames=function(t){var e=t,n=e.toLowerCase();return this.getFields().then(function(e){var i=o.chain(e).map(function(t){return{index:t.toLowerCase().indexOf(n),field:t+":"}}).filter(function(e){return-1!=e.index&&e.field.length>t.length}).sortBy("index").map(function(t){return t.field}).value();return i=o.first(i,5)})},t.INDEX=64,t}();e.FieldAddon=r},352:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(30),s=n(81),o=n(0),r=function(){function t(t){var e=this;this.omnibox=t,this.cache={},this.omnibox.bind.on(this.omnibox.element,i.OmniboxEvents.populateOmniboxSuggestions,function(t){t.suggestions.push(e.getSuggestion())})}return t.prototype.getSuggestion=function(){var t=this,e=this.getHash(this.omnibox.magicBox);if(null==e)return null;var n=this.hashToString(e);if(null!=this.cache[n])return this.hashValueToSuggestion(e,this.cache[n]);var i="QueryExtensionName"==e.type?this.names(e.current):this.attributeNames(e.name,e.current,e.used);return this.cache[n]=i,i.catch(function(){delete t.cache[n]}),this.hashValueToSuggestion(e,i)},t.prototype.getHash=function(t){var e=o.last(t.resultAtCursor("QueryExtension"));if(null!=e){var n=e.findAll("QueryExtensionArgument"),i=o.last(t.resultAtCursor("QueryExtensionName"));if(null!=i)return{type:"QueryExtensionName",current:i.toString(),before:i.before(),after:i.after()};if(null!=(i=o.last(t.resultAtCursor("QueryExtensionArgumentName")))){var s=o.chain(n).map(function(t){var e=t.find("QueryExtensionArgumentName");return e&&e.toString()}).compact().value(),r=e.find("QueryExtensionName").toString();return{type:"QueryExtensionArgumentName",current:i.toString(),before:i.before(),after:i.after(),name:r,used:s}}}return null},t.prototype.hashToString=function(t){return null==t?null:[t.type,t.current,t.name||"",t.used?t.used.join():""].join()},t.prototype.hashValueToSuggestion=function(e,n){return n.then(function(n){return o.map(n,function(i,o){return{html:s.MagicBox.Utils.highlightText(i,e.current,!0),text:e.before+i+e.after,index:t.INDEX-o/n.length}})})},t.prototype.getExtensions=function(){return null==this.extensions&&(this.extensions=this.omnibox.queryController.getEndpoint().extensions()),this.extensions},t.prototype.names=function(t){var e=t.toLowerCase();return this.getExtensions().then(function(t){var n=o.chain(t).map(function(t){return{index:t.name.toLowerCase().indexOf(e),extension:t.name}}).filter(function(t){return-1!=t.index&&t.extension.length>e.length}).sortBy("index").pluck("extension").value();return n=o.first(n,5)})},t.prototype.attributeNames=function(t,e,n){return this.getExtensions().then(function(i){var s=o.find(i,function(e){return e.name==t});return null==s?[]:o.filter(o.difference(s.argumentNames,n),function(t){return 0==t.indexOf(e)})})},t.prototype.hash=function(){},t.INDEX=62,t}();e.QueryExtensionAddon=r},353:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),s=n(24),o=n(30),r=n(18),u=n(326),a=n(0),l=function(){function t(t){var e=this;this.omnibox=t,this.cache=new u.SuggestionsCache,i.$$(this.omnibox.element).on(o.OmniboxEvents.populateOmniboxSuggestions,function(t,n){n.suggestions.push(e.getSuggestion())})}return t.suggestiontHtml=function(t){return t.highlighted.replace(/\[(.*?)\]|\{(.*?)\}|\((.*?)\)/g,function(t,e,n,s){var o="";n&&(o="coveo-omnibox-hightlight"),s&&(o="coveo-omnibox-hightlight2");var r;return r=o?i.$$("span",{className:o}):i.$$("span"),r.text(e||n||s),r.el.outerHTML})},t.isPartialMatch=function(t){var e=r.StringUtils.match(t.highlighted,/\[(.*?)\]|\{(.*?)\}|\((.*?)\)/g),n=a.find(e,function(t){return null!=t[1]});return null==n||a.every(a.last(e,a.indexOf(e,n)-e.length),function(t){return null!=t[1]})},t.prototype.getSuggestion=function(){var t=this,e=this.omnibox.magicBox.getText();return this.cache.getSuggestions(e,function(){return t.getQuerySuggest(e)})},t.prototype.getQuerySuggest=function(e){var n={q:e},i=String.locale,o=this.omnibox.getBindings().componentOptionsModel.get(s.ComponentOptionsModel.attributesEnum.searchHub),r=this.omnibox.getBindings().searchInterface.options.pipeline,u=this.omnibox.options.enableSearchAsYouType,l=this.omnibox.getBindings().searchInterface.getQueryContext();return i&&(n.locale=i),o&&(n.searchHub=o),r&&(n.pipeline=r),l&&(n.context=l),n.enableWordCompletion=u,this.omnibox.queryController.getEndpoint().getQuerySuggest(n).then(function(e){var n=e.completions;return a.map(n,function(e,i){return{html:t.suggestiontHtml(e),text:e.expression,index:t.INDEX-i/n.length,partial:t.isPartialMatch(e),executableConfidence:e.executableConfidence}})})},t.INDEX=60,t}();e.QuerySuggestAddon=l;var c=function(){function t(){}return t.prototype.getSuggestion=function(){return Promise.resolve([])},t}();e.VoidQuerySuggestAddon=c},354:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(30),s=n(2),o=n(4),r=n(0),u=function(){function t(t){var e=this;this.omnibox=t,this.omnibox.bind.on(this.omnibox.element,i.OmniboxEvents.populateOmniboxSuggestions,function(t){r.each(e.getSuggestion(),function(e){t.suggestions.push(e)})})}return t.prototype.getSuggestion=function(){if(0==this.omnibox.magicBox.getText().length)return null;var t=this.buildPopulateOmniboxEventArgs();return s.$$(this.omnibox.root).trigger(i.OmniboxEvents.populateOmnibox,t),this.rowsToSuggestions(t.rows)},t.prototype.getCurrentQueryExpression=function(){var t=this.omnibox.getCursor(),e=this.omnibox.getText(),n=e.length,i=t,s=t;for(" "==e[i]&&i--;i>0&&" "!=e[i];)i--;for(;s<n&&" "!=e[s];)s++;return e.substring(i,s)},t.prototype.getRegexToSearch=function(t){return null==t&&(t=this.omnibox.getText()),new RegExp(o.Utils.escapeRegexCharacter(t),"i")},t.prototype.getQueryExpressionBreakDown=function(){var t=this,e=[],n=this.omnibox.getText().split(" ");return r.each(n,function(n){e.push({word:n,regex:t.getRegexToSearch(n)})}),e},t.prototype.replace=function(t,e){this.omnibox.setText(this.omnibox.getText().replace(t,e))},t.prototype.clearCurrentExpression=function(){this.replace(this.getCurrentQueryExpression(),"")},t.prototype.insertAt=function(t,e){var n=this.omnibox.getText(),i=[n.slice(0,t),e,n.slice(t)].join("");this.omnibox.setText(i)},t.prototype.replaceCurrentExpression=function(t){this.replace(this.getCurrentQueryExpression(),t)},t.prototype.buildPopulateOmniboxEventArgs=function(){var t=this,e=this.getCurrentQueryExpression();return{rows:[],completeQueryExpression:{word:this.omnibox.getText(),regex:this.getRegexToSearch()},currentQueryExpression:{word:e,regex:this.getRegexToSearch(e)},allQueryExpressions:this.getQueryExpressionBreakDown(),cursorPosition:this.omnibox.getCursor(),clear:function(){t.omnibox.clear()},clearCurrentExpression:function(){t.clearCurrentExpression()},replace:function(e,n){t.replace(e,n)},replaceCurrentExpression:function(e){t.replaceCurrentExpression(e)},insertAt:function(e,n){t.insertAt(e,n)},closeOmnibox:function(){t.omnibox.magicBox.blur()}}},t.prototype.rowsToSuggestions=function(t){return r.map(t,function(t){return o.Utils.isNullOrUndefined(t.element)?o.Utils.isNullOrUndefined(t.deferred)?null:new Promise(function(e){t.deferred.then(function(t){e(null!=t.element?[{dom:t.element,index:t.zIndex}]:null)})}):new Promise(function(e){e([{dom:t.element,index:t.zIndex}])})})},t}();e.OldOmniboxAddon=u},355:function(t,e){},444:function(t,e){},81:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t};Object.defineProperty(e,"__esModule",{value:!0});var o=n(24);e.MagicBox=n(323);var r=n(6),u=n(7),a=n(10),l=n(68),c=n(16),p=n(12),h=n(9),g=n(30),d=n(2),f=n(5),m=n(12),y=n(1),x=n(94),b=n(351),v=n(352),S=n(353),C=n(354),E=n(324),A=n(87),Q=n(4),O=n(17),T=n(0),B=n(3);n(355);var w=n(84),_=n(325),M=function(t){function n(e,i,s){var r=t.call(this,e,n.ID,s)||this;r.element=e,r.options=i,r.partialQueries=[],r.lastSuggestions=[],r.movedOnce=!1,r.skipAutoSuggest=!1,r.options=u.ComponentOptions.initComponentOptions(e,n,i);var h=r.options.enableQuerySyntax;return new _.QueryboxOptionsProcessing(r).postProcess(),d.$$(r.element).toggleClass("coveo-query-syntax-disabled",0==r.options.enableQuerySyntax),r.suggestionAddon=r.options.enableQuerySuggestAddon?new S.QuerySuggestAddon(r):new S.VoidQuerySuggestAddon,new C.OldOmniboxAddon(r),r.createMagicBox(),r.bind.onRootElement(a.QueryEvents.buildingQuery,function(t){return r.handleBuildingQuery(t)}),r.bind.onRootElement(l.StandaloneSearchInterfaceEvents.beforeRedirect,function(){return r.handleBeforeRedirect()}),r.bind.onRootElement(a.QueryEvents.querySuccess,function(){return r.handleQuerySuccess()}),r.bind.onQueryState(c.MODEL_EVENTS.CHANGE_ONE,p.QUERY_STATE_ATTRIBUTES.Q,function(t){return r.handleQueryStateChanged(t)}),r.isAutoSuggestion()&&r.bind.onRootElement(a.QueryEvents.duringQuery,function(t){return r.handleDuringQuery(t)}),r.bind.onComponentOptions(c.MODEL_EVENTS.CHANGE_ONE,o.COMPONENT_OPTIONS_ATTRIBUTES.SEARCH_BOX,function(t){null!=t.value.enableQuerySyntax?r.options.enableQuerySyntax=t.value.enableQuerySyntax:r.options.enableQuerySyntax=h,r.updateGrammar()}),r}return i(n,t),n.prototype.submit=function(){var t=this;this.magicBox.clearSuggestion(),this.updateQueryState(),this.triggerNewQuery(!1,function(){w.logSearchBoxSubmitEvent(t.usageAnalytics)}),this.magicBox.blur()},n.prototype.getText=function(){return this.magicBox.getText()},n.prototype.setText=function(t){this.magicBox.setText(t),this.updateQueryState()},n.prototype.clear=function(){this.magicBox.clear()},n.prototype.getInput=function(){return this.magicBox.element.querySelector("input")},n.prototype.getResult=function(){return this.magicBox.getResult()},n.prototype.getDisplayedResult=function(){return this.magicBox.getDisplayedResult()},n.prototype.getCursor=function(){return this.magicBox.getCursor()},n.prototype.resultAtCursor=function(t){return this.magicBox.resultAtCursor(t)},n.prototype.createGrammar=function(){var t=null;return this.options.enableQuerySyntax?(t=e.MagicBox.Grammars.Expressions(e.MagicBox.Grammars.Complete),this.options.enableFieldAddon&&new b.FieldAddon(this),null!=this.options.fieldAlias&&(this.options.listOfFields=this.options.listOfFields||[],this.options.listOfFields=this.options.listOfFields.concat(T.keys(this.options.fieldAlias))),this.options.enableQueryExtensionAddon&&new v.QueryExtensionAddon(this)):t={start:"Any",expressions:{Any:/.*/}},null!=this.options.grammar&&(t=this.options.grammar(t)),t},n.prototype.updateGrammar=function(){var t=this.createGrammar();this.magicBox.grammar=new e.MagicBox.Grammar(t.start,t.expressions),this.magicBox.setText(this.magicBox.getText())},n.prototype.createMagicBox=function(){var t=this.createGrammar();this.magicBox=e.MagicBox.create(this.element,new e.MagicBox.Grammar(t.start,t.expressions),{inline:this.options.inline,selectableSuggestionClass:"coveo-omnibox-selectable",selectedSuggestionClass:"coveo-omnibox-selected",suggestionTimeout:this.options.omniboxTimeout}),this.setupMagicBox()},n.prototype.setupMagicBox=function(){var t=this;this.magicBox.onmove=function(){t.isAutoSuggestion()&&(t.modifyEventTo=t.getOmniboxAnalyticsEventCause()),t.movedOnce=!0},this.magicBox.onfocus=function(){t.isAutoSuggestion()&&(t.skipAutoSuggest=!0)},this.magicBox.onsuggestions=function(e){Q.Utils.isEmptyString(t.getText())&&(t.partialQueries=[]),t.movedOnce=!1,t.lastSuggestions=e,t.isAutoSuggestion()&&!t.skipAutoSuggest&&t.searchAsYouType()},this.options.enableSearchAsYouType&&d.$$(this.element).addClass("coveo-magicbox-search-as-you-type"),this.magicBox.onchange=function(){t.skipAutoSuggest=!1;var e=t.getText();void 0!=e&&""!=e?t.isAutoSuggestion()?t.movedOnce&&t.searchAsYouType(!0):t.options.enableSearchAsYouType&&t.searchAsYouType(!0):t.clear()},this.options.placeholder&&(this.magicBox.element.querySelector("input").placeholder=this.options.placeholder),this.magicBox.onsubmit=function(){return t.submit()},this.magicBox.onselect=function(e){var n=T.indexOf(t.lastSuggestions,e),i=T.compact(T.map(t.lastSuggestions,function(t){return t.text}));t.magicBox.clearSuggestion(),t.updateQueryState(),t.isAutoSuggestion()?t.isAutoSuggestion()&&t.movedOnce?t.handleAutoSuggestionWithKeyboard(n,i):t.isAutoSuggestion()&&!t.movedOnce&&t.handleAutoSuggestionsWithMouse(n,i):(t.usageAnalytics.cancelAllPendingEvents(),t.triggerNewQuery(!1,function(){t.usageAnalytics.logSearchEvent(t.getOmniboxAnalyticsEventCause(),t.buildCustomDataForPartialQueries(n,i))})),t.isAutoSuggestion()&&(t.partialQueries=[])},this.magicBox.onblur=function(){t.isAutoSuggestion()&&(t.setText(t.getQuery(!0)),t.usageAnalytics.sendAllPendingEvents())},this.magicBox.onclear=function(){t.updateQueryState(),(t.options.triggerQueryOnClear||t.options.enableSearchAsYouType)&&t.triggerNewQuery(!1,function(){t.usageAnalytics.logSearchEvent(h.analyticsActionCauseList.searchboxClear,{})})},this.magicBox.ontabpress=function(){t.handleTabPress()},this.magicBox.getSuggestions=function(){return t.handleSuggestions()}},n.prototype.handleAutoSuggestionWithKeyboard=function(t,e){var n=this;this.searchAsYouTypeTimeout?(this.usageAnalytics.cancelAllPendingEvents(),clearTimeout(this.searchAsYouTypeTimeout),this.searchAsYouTypeTimeout=void 0,this.triggerNewQuery(!1,function(){n.usageAnalytics.logSearchEvent(n.getOmniboxAnalyticsEventCause(),n.buildCustomDataForPartialQueries(t,e))})):(this.modifyEventTo=this.getOmniboxAnalyticsEventCause(),this.modifyCustomDataOnPending(t,e),this.modifyQueryContentOnPending(),this.usageAnalytics.sendAllPendingEvents())},n.prototype.handleAutoSuggestionsWithMouse=function(t,e){var n=this;this.searchAsYouTypeTimeout||0!=t?(this.clearSearchAsYouType(),this.usageAnalytics.cancelAllPendingEvents(),this.triggerNewQuery(!1,function(){n.usageAnalytics.logSearchEvent(n.getOmniboxAnalyticsEventCause(),n.buildCustomDataForPartialQueries(t,e))})):(this.modifyEventTo=this.getOmniboxAnalyticsEventCause(),this.modifyCustomDataOnPending(t,e),this.modifyQueryContentOnPending(),this.usageAnalytics.sendAllPendingEvents(),this.lastQuery!=this.getText()&&this.triggerNewQuery(!1,function(){n.usageAnalytics.logSearchEvent(n.getOmniboxAnalyticsEventCause(),n.buildCustomDataForPartialQueries(t,e))}))},n.prototype.modifyCustomDataOnPending=function(t,e){var n=this.usageAnalytics.getPendingSearchEvent();if(n instanceof A.PendingSearchAsYouTypeSearchEvent){var i=this.buildCustomDataForPartialQueries(t,e);T.each(T.keys(i),function(t){n.modifyCustomData(t,i[t])})}},n.prototype.modifyQueryContentOnPending=function(){var t=this.usageAnalytics.getPendingSearchEvent();if(t instanceof A.PendingSearchAsYouTypeSearchEvent){var e=this.getQuery(this.options.enableSearchAsYouType);t.modifyQueryContent(e)}},n.prototype.buildCustomDataForPartialQueries=function(t,e){return{partialQueries:this.cleanCustomData(this.partialQueries),suggestionRanking:t,suggestions:this.cleanCustomData(e),partialQuery:T.last(this.partialQueries)}},n.prototype.cleanCustomData=function(t,e){void 0===e&&(e=256),t=T.compact(T.filter(t,function(t,e,n){return 0===e||t!==n[e-1]})),t=T.map(t,function(t){return t.replace(/;/g,"")});var n=[];return T.reduceRight(t,function(t,i){var s=t+i.length;return s<=e&&n.push(i),s},0),t=n.reverse(),t.join(";").length>=256?this.cleanCustomData(t,e-10):t.join(";")},n.prototype.handleSuggestions=function(){var t={suggestions:[],omnibox:this};this.bind.trigger(this.element,g.OmniboxEvents.populateOmniboxSuggestions,t);var e=this.getText();return Q.Utils.isNullOrEmptyString(e)||this.partialQueries.push(e),T.compact(t.suggestions)},n.prototype.handleBeforeRedirect=function(){this.updateQueryState()},n.prototype.handleBuildingQuery=function(t){var e=this;f.Assert.exists(t),f.Assert.exists(t.queryBuilder),this.updateQueryState(),this.lastQuery=this.getQuery(t.searchAsYouType);var n=this.lastQuery==this.magicBox.getDisplayedResult().input?this.magicBox.getDisplayedResult().clone():this.magicBox.grammar.parse(this.lastQuery).clean(),i={result:n};if(this.options.enableQuerySyntax){var s=i.result.findAll("FieldValueNotQuoted");if(T.each(s,function(t){return t.value='"'+t.value.replace(/"|\u00A0/g," ")+'"'}),this.options.fieldAlias){var o=i.result.findAll(function(t){return"FieldName"==t.expression.id&&t.isSuccess()});T.each(o,function(t){var n=T.find(T.keys(e.options.fieldAlias),function(e){return e.toLowerCase()==t.value.toLowerCase()});null!=n&&(t.value=e.options.fieldAlias[n])})}}this.bind.trigger(this.element,g.OmniboxEvents.omniboxPreprocessResultForQuery,i);var r=i.result.toString();new E.QueryboxQueryParameters(this.options).addParameters(t.queryBuilder,r)},n.prototype.handleTabPress=function(){this.options.enableQuerySuggestAddon&&this.handleTabPressForSuggestions(),this.handleTabPressForOldOmniboxAddon()},n.prototype.handleTabPressForSuggestions=function(){if(this.options.enableSearchAsYouType)this.setText(this.getQuery(!0));else{var t=T.compact(T.map(this.lastSuggestions,function(t){return t.text}));this.usageAnalytics.logCustomEvent(this.getOmniboxAnalyticsEventCause(),this.buildCustomDataForPartialQueries(0,t),this.element)}},n.prototype.handleTabPressForOldOmniboxAddon=function(){var t=this.lastSuggestions.filter(function(t){return t.dom}).map(function(t){return d.$$(t.dom)}),e=this.findAllElementsWithClass(t,".coveo-omnibox-selected");if(e.length>0)d.$$(e[0]).trigger("tabSelect");else if(!this.options.enableQuerySuggestAddon){var n=this.findAllElementsWithClass(t,".coveo-omnibox-selectable");n.length>0&&d.$$(n[0]).trigger("tabSelect")}},n.prototype.findAllElementsWithClass=function(t,e){return t.map(function(t){return t.find(e)}).filter(function(t){return t}).reduce(function(t,e){return t.concat(e)},[])},n.prototype.triggerNewQuery=function(t,e){clearTimeout(this.searchAsYouTypeTimeout);var n=this.getQuery(t);this.shouldExecuteQuery(t)&&(this.lastQuery=n,e(),this.queryController.executeQuery({searchAsYouType:t,logInActionsHistory:!0}))},n.prototype.getQuery=function(t){if(this.lastQuery==this.magicBox.getText())return this.lastQuery;if(!t)return this.magicBox.getText();var e=this.magicBox.getWordCompletion();if(null!=e)return e;var n=this.magicBox.getWordCompletion()||this.getFirstSuggestion();return n||(this.isAutoSuggestion()?this.lastQuery||this.magicBox.getText():this.magicBox.getText())},n.prototype.getFirstSuggestion=function(){if(null==this.lastSuggestions)return"";if(this.lastSuggestions.length<=0)return"";var t=T.find(this.lastSuggestions,function(t){return null!=t.text});return null==t?"":t.text},n.prototype.updateQueryState=function(){this.queryStateModel.set(m.QueryStateModel.attributesEnum.q,this.magicBox.getText())},n.prototype.handleQueryStateChanged=function(t){f.Assert.exists(t);var e=t.value;e!=this.magicBox.getText()&&this.magicBox.setText(e)},n.prototype.handleQuerySuccess=function(){this.isAutoSuggestion()||(this.partialQueries=[])},n.prototype.handleDuringQuery=function(t){var e=this;t.promise.then(function(){var n=e.usageAnalytics.getPendingSearchEvent();n instanceof A.PendingSearchAsYouTypeSearchEvent&&n.beforeResolve.then(function(n){t.promise.then(function(){e.modifyEventTo&&(n.modifyEventCause(e.modifyEventTo),e.modifyEventTo=null)})})})},n.prototype.searchAsYouType=function(t){var e=this;void 0===t&&(t=!1),this.clearSearchAsYouType(),this.shouldExecuteQuery(!0)&&(this.searchAsYouTypeTimeout=window.setTimeout(function(){if(e.suggestionShouldTriggerQuery()||t){var n=T.map(e.lastSuggestions,function(t){return t.text}),i=T.indexOf(n,e.magicBox.getWordCompletion());e.triggerNewQuery(!0,function(){e.usageAnalytics.logSearchAsYouType(h.analyticsActionCauseList.searchboxAsYouType,e.buildCustomDataForPartialQueries(i,n))}),e.clearSearchAsYouType()}},this.options.searchAsYouTypeDelay))},n.prototype.isAutoSuggestion=function(){return this.options.enableSearchAsYouType&&this.options.enableQuerySuggestAddon},n.prototype.shouldExecuteQuery=function(t){var e=this.getQuery(t);return!1===this.searchInterface.options.allowQueriesWithoutKeywords?this.lastQuery!=e&&Q.Utils.isNonEmptyString(e):this.lastQuery!=e&&null!=e},n.prototype.suggestionShouldTriggerQuery=function(t){if(void 0===t&&(t=this.lastSuggestions),this.shouldExecuteQuery(!0)&&t&&t[0]){var e=t[0];if(e&&void 0!=e.executableConfidence)return e.executableConfidence>=.8;if(e.text&&0==e.text.indexOf(this.magicBox.getText()))return!0}return!1},n.prototype.clearSearchAsYouType=function(){clearTimeout(this.searchAsYouTypeTimeout),this.searchAsYouTypeTimeout=void 0},n.prototype.getOmniboxAnalyticsEventCause=function(){return this.searchInterface instanceof O.StandaloneSearchInterface?h.analyticsActionCauseList.omniboxFromLink:h.analyticsActionCauseList.omniboxAnalytics},n.ID="Omnibox",n.doExport=function(){B.exportGlobally({Omnibox:n,MagicBox:e.MagicBox,QueryboxQueryParameters:E.QueryboxQueryParameters})},n.options={inline:u.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableSearchAsYouType:u.ComponentOptions.buildBooleanOption({defaultValue:!1,section:"SearchAsYouType"}),searchAsYouTypeDelay:u.ComponentOptions.buildNumberOption({defaultValue:2e3,min:0,depend:"enableSearchAsYouType",section:"SearchAsYouType"}),enableFieldAddon:u.ComponentOptions.buildBooleanOption({defaultValue:!1,depend:"enableQuerySyntax",postProcessing:function(t,e){return t&&(e.enableQuerySyntax=!0),t},section:"QuerySyntax"}),enableSimpleFieldAddon:u.ComponentOptions.buildBooleanOption({defaultValue:!1,depend:"enableFieldAddon"}),listOfFields:u.ComponentOptions.buildFieldsOption({depend:"enableFieldAddon"}),enableQuerySuggestAddon:u.ComponentOptions.buildBooleanOption({defaultValue:!0,alias:["enableTopQueryAddon","enableRevealQuerySuggestAddon"]}),enableQueryExtensionAddon:u.ComponentOptions.buildBooleanOption({defaultValue:!1,depend:"enableQuerySyntax",postProcessing:function(t,e){return t&&(e.enableQuerySyntax=!0),t},section:"QuerySyntax"}),placeholder:u.ComponentOptions.buildLocalizedStringOption(),omniboxTimeout:u.ComponentOptions.buildNumberOption({defaultValue:2e3,min:0}),enableQuerySyntax:u.ComponentOptions.buildBooleanOption({defaultValue:!1,section:"QuerySyntax"})},n}(r.Component);e.Omnibox=M,M.options=s({},M.options,x.Querybox.options),y.Initialization.registerAutoCreateComponent(M)},94:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MagicBox=n(323);var s=n(1),o=n(6),r=n(7),u=n(10),a=n(16),l=n(12),c=n(68),p=n(9),h=n(2),g=n(5),d=n(324),f=n(3),m=n(325),y=function(t){function n(i,s,o){var g=t.call(this,i,n.ID,o)||this;return g.element=i,g.options=s,g.bindings=o,i instanceof HTMLInputElement&&g.logger.error("Querybox cannot be used on an HTMLInputElement"),g.options=r.ComponentOptions.initComponentOptions(i,n,s),new m.QueryboxOptionsProcessing(g).postProcess(),h.$$(g.element).toggleClass("coveo-query-syntax-disabled",0==g.options.enableQuerySyntax),g.magicBox=e.MagicBox.create(i,new e.MagicBox.Grammar("Query",{Query:"[Term*][Spaces?]",Term:"[Spaces?][Word]",Spaces:/ +/,Word:/[^ ]+/}),{inline:!0}),g.bind.onRootElement(u.QueryEvents.buildingQuery,function(t){return g.handleBuildingQuery(t)}),g.bind.onRootElement(c.StandaloneSearchInterfaceEvents.beforeRedirect,function(){return g.updateQueryState()}),g.bind.onQueryState(a.MODEL_EVENTS.CHANGE_ONE,l.QUERY_STATE_ATTRIBUTES.Q,function(t){return g.handleQueryStateChanged(t)}),g.options.enableSearchAsYouType&&(h.$$(g.element).addClass("coveo-search-as-you-type"),g.magicBox.onchange=function(){g.searchAsYouType()}),g.magicBox.onsubmit=function(){g.submit()},g.magicBox.onblur=function(){g.updateQueryState()},g.magicBox.onclear=function(){g.updateQueryState(),g.options.triggerQueryOnClear&&(g.usageAnalytics.logSearchEvent(p.analyticsActionCauseList.searchboxClear,{}),g.triggerNewQuery(!1))},g}return i(n,t),n.prototype.submit=function(){this.magicBox.clearSuggestion(),this.updateQueryState(),this.usageAnalytics.logSearchEvent(p.analyticsActionCauseList.searchboxSubmit,{}),this.triggerNewQuery(!1)},n.prototype.setText=function(t){this.magicBox.setText(t),this.updateQueryState()},n.prototype.clear=function(){this.magicBox.clear()},n.prototype.getText=function(){return this.magicBox.getText()},n.prototype.getResult=function(){return this.magicBox.getResult()},n.prototype.getDisplayedResult=function(){return this.magicBox.getDisplayedResult()},n.prototype.getCursor=function(){return this.magicBox.getCursor()},n.prototype.resultAtCursor=function(t){return this.magicBox.resultAtCursor(t)},n.prototype.handleBuildingQuery=function(t){g.Assert.exists(t),g.Assert.exists(t.queryBuilder),this.updateQueryState(),this.lastQuery=this.magicBox.getText(),new d.QueryboxQueryParameters(this.options).addParameters(t.queryBuilder,this.lastQuery)},n.prototype.triggerNewQuery=function(t){clearTimeout(this.searchAsYouTypeTimeout);var e=this.magicBox.getText();this.lastQuery!=e&&null!=e&&(this.lastQuery=e,this.queryController.executeQuery({searchAsYouType:t,logInActionsHistory:!0}))},n.prototype.updateQueryState=function(){this.queryStateModel.set(l.QueryStateModel.attributesEnum.q,this.magicBox.getText())},n.prototype.handleQueryStateChanged=function(t){g.Assert.exists(t);var e=t.value;e!=this.magicBox.getText()&&this.magicBox.setText(e)},n.prototype.searchAsYouType=function(){var t=this;clearTimeout(this.searchAsYouTypeTimeout),this.searchAsYouTypeTimeout=window.setTimeout(function(){t.usageAnalytics.logSearchAsYouType(p.analyticsActionCauseList.searchboxAsYouType,{}),t.triggerNewQuery(!0)},this.options.searchAsYouTypeDelay)},n.ID="Querybox",n.doExport=function(){f.exportGlobally({Querybox:n,MagicBox:e.MagicBox,QueryboxQueryParameters:d.QueryboxQueryParameters})},n.options={enableSearchAsYouType:r.ComponentOptions.buildBooleanOption({defaultValue:!1,section:"SearchAsYouType"}),searchAsYouTypeDelay:r.ComponentOptions.buildNumberOption({defaultValue:50,min:0,section:"SearchAsYouType"}),enableQuerySyntax:r.ComponentOptions.buildBooleanOption({defaultValue:!1,section:"QuerySyntax"}),enableWildcards:r.ComponentOptions.buildBooleanOption({defaultValue:!1,section:"QuerySyntax"}),enableQuestionMarks:r.ComponentOptions.buildBooleanOption({defaultValue:!1,depend:"enableWildcards"}),enableLowercaseOperators:r.ComponentOptions.buildBooleanOption({defaultValue:!1,depend:"enableQuerySyntax"}),enablePartialMatch:r.ComponentOptions.buildBooleanOption({defaultValue:!1}),partialMatchKeywords:r.ComponentOptions.buildNumberOption({defaultValue:5,min:1,depend:"enablePartialMatch"}),partialMatchThreshold:r.ComponentOptions.buildStringOption({defaultValue:"50%",depend:"enablePartialMatch"}),triggerQueryOnClear:r.ComponentOptions.buildBooleanOption({defaultValue:!1})},n}(o.Component);e.Querybox=y,s.Initialization.registerAutoCreateComponent(y)}});