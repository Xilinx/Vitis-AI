<!--
 Copyright 2019 Xilinx Inc.
 
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
 
     http://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

# Introduction
_**XNNC**_, short for eXtensible Neural Network Converter, serves as a model converter to translate CNN models generated from different machine learning frameworks, such as TensorFlow, into a uniform graph representaton, which is target-independent, and, according to the business requirements, would be translated further into other custom IRs for different level usages, for example *XIR*.  According to the current design requirements, *XNNC* supports quantized TensorFlow 1.9+ and TensorFlow kears 2.0+ models generated by vai_q_tensorflow1.x and vai_q_tensorflow2.x.

 
# XNNC Quick Start

After reading following sections, you will know how to deploy *XNNC* on your system and basic commands for use.

## Prerequisites
To deploy *XNNC*, *Python 3.8+* and *pip3* are required.

* Dependencies

  *XNNC* depends on the following packages:
  
  ```bash
  marshmallow>=3.0.0rc5
  tqdm>=4.31.1
  numpy>=1.16.4
  graphviz>=0.11.1
  protobuf>=3.6.1
  h5py>=2.10.0
  ```

  To quick install the packages, open Terminal and go into the root directory of *XNNC* source; then run the command below:

  ```bash 
  pip3 install -r requirements.txt
  ```

## Installation

Currently, *XNNC* only supports installation from source. 

* First, generate a installation binary file (*.whl*) from source code by running the following command in the root directory of *XNNC*:

  ```bash
  python3 setup.py sdist bdist_wheel
  ```

* After that, a folder named dist is generated, in which the installation binary file suffixed with *.whl* should be found, for example, *xnnc-3.5.0-py3-none-any.whl*. Running the command below to install *XNNC*

  ```bash
  pip3 install xnnc-3.5.0-py3-none-any.whl
  ```

* To check if the installation is successful, try the following command: 
  ```bash
  xnnc-run --help
  ```

## Basic Usages
For now, *XNNC* supports the conversion of quantized TensorFlow (1.12+, 2.0+) and Caffe models into XIR models (*.xmodel*).

* __Tensorflow Models__

  To convert a quantized TensorFlow model into xmodel, for example ResNet50, simply run the following command in terminal:
  ```bash
  xnnc-run --type tensorflow --layout NHWC --model /path/to/resnet50.pb --out /path/to/resnet50.xmodel
  ```
  
  In some cases, the inputs shape of a model is customized. The CLI of XNNC provides _--inputs-shape_ option for that.

  ```bash
  xnnc-run --type tensorflow --layout NHWC --model /path/to/yolov3_voc.pb --inputs-shape 1,416,416,3 --out /path/to/yolov3_voc.xmodel
  ``` 

  Notice that the argument value for _**--layout**_ option must be capitalized.


* Caffe Models
  For Caffe model, you should specify _**--model**_ option twice, one for specifying _**.caffemodel**_ file, one for _**.prototxt**_ file:
  ```bash
  xnnc-run --type caffe --layout NCHW --model /path/to/resnet50.caffemodel --proto /path/to/resnet50.prototxt --out /path/to/resnet50.xmodel
  ```

All command options available for *XNNC* are listed below. You can get them by the command _**xnnc-run --help**_.

```bash
usage: xnnc-run [-h] --model MODEL_FILES [--proto PROTO] --type
                {tensorflow,tensorflow2,caffe} --layout {NHWC,NCHW}
                [--version] --out OUT_FILENAME
                [--inputs-shape INPUTS_SHAPE | --batchsize BATCHSIZE | --named-inputs-shape [NAMED_INPUTS_SHAPE [NAMED_INPUTS_SHAPE ...]]]
                
optional arguments:
  -h, --help            show this help message and exit
  --version             show program's version number and exit

  --model MODEL_FILES   file name to TensorFlow 1.12+ frozen model file
                        (*.pb), TensorFlow 2.0+ frozen model file (*.h5), or
                        Caffe caffemodel (*.caffemodel).
  --proto PROTO         file name to Caffe prototxt files.
  --type {tensorflow,tensorflow2,caffe}
                        type of raw model.
  --layout {NHWC,NCHW}  data format used in raw model: 'NHWC' or 'NCHW',
                        default='NHWC'.
  
  --inputs-shape INPUTS_SHAPE
                        shape of one or more input feature maps. For example,
                        to specify input shape for input layer, use --inputs-shape
                        1,416,416,3
  --named-inputs-shape [NAMED_INPUTS_SHAPE [NAMED_INPUTS_SHAPE ...]]
                        pairs of name and shape of two or more input layers.
                        For example, to specify two input shapes, use --inputs
                        input_layer1_name:1,416,416,3
                        input_layer2_name:1,256,256,3
  --batchsize BATCHSIZE
                        target batchsize >= 1
  --out OUT_FILENAME    file name of the generated xmodel.
```
